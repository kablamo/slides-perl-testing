<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::Cover Version 1.20
Devel::Cover is copyright 2001-2012, Paul Johnson (paul@pjcj.net)
Devel::Cover is free. It is licensed under the same terms as Perl itself.
The latest version of Devel::Cover should be available from my homepage:
http://www.pjcj.net
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <meta http-equiv="Content-Language" content="en-us"></meta>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <title>File Coverage: local/lib/perl5/Test/Differences.pm</title>
</head>
<body>
<h1>File Coverage</h1>
<table>
<tr><td class="h" align="right">File:</td><td align="left">local/lib/perl5/Test/Differences.pm</td></tr>
<tr><td class="h" align="right">Coverage:</td><td align="left" class="c0">11.5%</td></tr>
</table>
<div><br/></div>
<table>
<tr><th>line</th><th>stmt</th><th>bran</th><th>cond</th><th>sub</th><th>time</th><th>code</th></tr>
<tr><td class="h">1</td><td></td><td></td><td></td><td></td><td></td><td class="s">package Test::Differences;</td></tr>
<tr><td class="h">2</td><td colspan="6"></td></tr><tr><td class="h">3 - 284</td><td colspan="5"></td><td class="s"><pre>=head1 NAME

Test::Differences - Test strings and data structures and show differences if not ok

=head1 VERSION

0.61

=head1 SYNOPSIS

&nbsp;&nbsp;&nbsp;use Test;&nbsp;&nbsp;&nbsp;&nbsp;## Or use Test::More
&nbsp;&nbsp;&nbsp;use Test::Differences;

&nbsp;&nbsp;&nbsp;eq_or_diff $got,&nbsp;&nbsp;&quot;a\nb\nc\n&quot;,&nbsp;&nbsp;&nbsp;&quot;testing strings&quot;;
&nbsp;&nbsp;&nbsp;eq_or_diff \@got, [qw( a b c )], &quot;testing arrays&quot;;

&nbsp;&nbsp;&nbsp;## Passing options:
&nbsp;&nbsp;&nbsp;eq_or_diff $got, $expected, $name, { context =&gt; 300 };&nbsp;&nbsp;## options

&nbsp;&nbsp;&nbsp;## Using with DBI-like data structures

&nbsp;&nbsp;&nbsp;use DBI;

&nbsp;&nbsp;&nbsp;... open connection &amp; prepare statement and @expected_... here...

&nbsp;&nbsp;&nbsp;eq_or_diff $sth-&gt;fetchall_arrayref, \@expected_arrays&nbsp;&nbsp;&quot;testing DBI arrays&quot;;
&nbsp;&nbsp;&nbsp;eq_or_diff $sth-&gt;fetchall_hashref,&nbsp;&nbsp;\@expected_hashes, &quot;testing DBI hashes&quot;;

&nbsp;&nbsp;&nbsp;## To force textual or data line numbering (text lines are numbered 1..):
&nbsp;&nbsp;&nbsp;eq_or_diff_text ...;
&nbsp;&nbsp;&nbsp;eq_or_diff_data ...;

=head1 EXPORT

This module exports three test functions and four diff-style functions:

=over 4

=item * Test functions

=over 4

=item * C&lt;eq_or_diff&gt;

=item * C&lt;eq_or_diff_data&gt;

=item * C&lt;eq_or_diff_text&gt;

=back

=item * Diff style functions

=over 4

=item * C&lt;table_diff&gt; (the default)

=item * C&lt;unified_diff&gt;

=item * C&lt;oldstyle_diff&gt;

=item * C&lt;context_diff&gt;

=back

=back

=head1 DESCRIPTION

When the code you&#39;re testing returns multiple lines, records or data
structures and they&#39;re just plain wrong, an equivalent to the Unix
C&lt;diff&gt; utility may be just what&#39;s needed.&nbsp;&nbsp;Here&#39;s output from an
example test script that checks two text documents and then two
(trivial) data structures:

 t/99example....1..3
 not ok 1 - differences in text
 #&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Failed test ((eval 2) at line 14)
 #&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+---+----------------+----------------+
 #&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| Ln|Got&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|Expected&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|
 #&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+---+----------------+----------------+
 #&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;1|this is line 1&nbsp;&nbsp;|this is line 1&nbsp;&nbsp;|
 #&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;2|this is line 2&nbsp;&nbsp;|this is line b&nbsp;&nbsp;*
 #&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;3|this is line 3&nbsp;&nbsp;|this is line 3&nbsp;&nbsp;|
 #&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+---+----------------+----------------+
 not ok 2 - differences in whitespace
 #&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Failed test ((eval 2) at line 20)
 #&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+---+------------------+------------------+
 #&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| Ln|Got&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|Expected&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|
 #&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+---+------------------+------------------+
 #&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;1|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indented&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indented&nbsp;&nbsp;|
 #&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;2|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indented&nbsp;&nbsp;|\tindented&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*
 #&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;3|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indented&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indented&nbsp;&nbsp;|
 #&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+---+------------------+------------------+
 not ok 3
 #&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Failed test ((eval 2) at line 22)
 #&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+----+-------------------------------------+----------------------------+
 #&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| Elt|Got&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|Expected&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|
 #&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+----+-------------------------------------+----------------------------+
 #&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;0|bless( [&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*
 #&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;1|&nbsp;&nbsp;&#39;Move along, nothing to see here&#39;&nbsp;&nbsp;|&nbsp;&nbsp;&#39;Dry, humorless message&#39;&nbsp;&nbsp;*
 #&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;2|], &#39;Test::Builder&#39; )&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*
 #&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+----+-------------------------------------+----------------------------+
 # Looks like you failed 3 tests of 3.

eq_or_diff_...() compares two strings or (limited) data structures and
either emits an ok indication or a side-by-side diff.&nbsp;&nbsp;Test::Differences
is designed to be used with Test.pm and with Test::Simple, Test::More,
and other Test::Builder based testing modules.&nbsp;&nbsp;As the SYNOPSIS shows,
another testing module must be used as the basis for your test suite.

These functions assume that you are presenting it with &quot;flat&quot; records,
looking like:

&nbsp;&nbsp;&nbsp;- scalars composed of record-per-line
&nbsp;&nbsp;&nbsp;- arrays of scalars,
&nbsp;&nbsp;&nbsp;- arrays of arrays of scalars,
&nbsp;&nbsp;&nbsp;- arrays of hashes containing only scalars

All of these are flattened in to single strings which are then compared
for differences.&nbsp;&nbsp;Differently data structures can be compared, as long
as they flatten identically.

All other data structures are run through Data::Dumper first.&nbsp;&nbsp;This is a
bit dangerous, as some versions of perl shipped with Data::Dumpers that
could do the oddest things with unexpected, like core dump.&nbsp;&nbsp;Only as of
5.8.0 does Data::Dumper sort hash keys, which is necessary for HASH
dumps to be fully predictable.&nbsp;&nbsp;This will be changed when this bites
somebody or I get some free time.

C&lt;eq_or_diff()&gt; starts counting records at 0 unless you pass it two text
strings:

&nbsp;&nbsp;&nbsp;eq_or_diff $a, $b;&nbsp;&nbsp;&nbsp;## First line is line number 1
&nbsp;&nbsp;&nbsp;eq_or_diff @a, @b;&nbsp;&nbsp;&nbsp;## First element is element 0
&nbsp;&nbsp;&nbsp;eq_or_diff $a, @b;&nbsp;&nbsp;&nbsp;## First line/element is element 0

If you want to force a first record number of 0, use C&lt;eq_or_diff_data&gt;.&nbsp;&nbsp;If
you want to force a first record number of 1, use C&lt;eq_or_diff_text&gt;.&nbsp;&nbsp;I chose
this over passing in an options hash because it&#39;s clearer and simpler this way.
YMMV.

=head1 OPTIONS

The options to C&lt;eq_or_diff&gt; give some fine-grained control over the output.

=over 4

=item * C&lt;context&gt;

This allows you to control the amount of context shown:

&nbsp;&nbsp;&nbsp;eq_or_diff $got, $expected, $name, { context =&gt; 50000 };

will show you lots and lots of context.&nbsp;&nbsp;Normally, eq_or_diff() uses
some heuristics to determine whether to show 3 lines of context (like
a normal unified diff) or 25 lines.

=item * C&lt;data_type&gt;

C&lt;text&gt; or C&lt;data&gt;. See C&lt;eq_or_diff_text&gt; and C&lt;eq_or_diff_data&gt; to
understand this. You can usually ignore this.

=item * C&lt;Sortkeys&gt;

If passed, whatever value is added is used as the argument for L&lt;Data::Dumper&gt;
Sortkeys option. See the L&lt;Data::Dumper&gt; docs to understand how you can
control the Sortkeys behavior.

=back

=head1 DIFF STYLES

For extremely long strings, a table diff can wrap on your screen and be hard
to read.&nbsp;&nbsp;If you are comfortable with different diff formats, you can switch
to a format more suitable for your data.&nbsp;&nbsp;These are the four formats supported
by the L&lt;Text::Diff&gt; module and are set with the following functions:

=over 4

=item * C&lt;table_diff&gt; (the default)

=item * C&lt;unified_diff&gt;

=item * C&lt;oldstyle_diff&gt;

=item * C&lt;context_diff&gt;

=back

You can run the following to understand the different diff output styles:

 use Test::More &#39;no_plan&#39;;
 use Test::Differences;

 my $long_string = join &#39;&#39; =&gt; 1..40;

 TODO: {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local $TODO = &#39;Testing diff styles&#39;;

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# this is the default and does not need to explicitly set unless you need
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# to reset it back from another diff type
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;table_diff;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq_or_diff $long_string, &quot;-$long_string&quot;, &#39;table diff&#39;;

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unified_diff;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq_or_diff $long_string, &quot;-$long_string&quot;, &#39;unified diff&#39;;

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context_diff;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq_or_diff $long_string, &quot;-$long_string&quot;, &#39;context diff&#39;;

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oldstyle_diff;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq_or_diff $long_string, &quot;-$long_string&quot;, &#39;oldstyle diff&#39;;
 }

=head1 DEPLOYING

There are several basic ways of deploying Test::Differences requiring more or less
labor by you or your users.

=over

=item *

Fallback to C&lt;is_deeply&gt;.

This is your best option if you want this module to be optional.

 use Test::More;
 BEGIN {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!eval q{ use Test::Differences; 1 }) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*eq_or_diff = \&amp;is_deeply;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 }

=item *

 eval &quot;use Test::Differences&quot;;

If you want to detect the presence of Test::Differences on the fly, something
like the following code might do the trick for you:

&nbsp;&nbsp;&nbsp;&nbsp;use Test qw( !ok );&nbsp;&nbsp;&nbsp;## get all syms *except* ok

&nbsp;&nbsp;&nbsp;&nbsp;eval &quot;use Test::Differences&quot;;
&nbsp;&nbsp;&nbsp;&nbsp;use Data::Dumper;

&nbsp;&nbsp;&nbsp;&nbsp;sub ok {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto &amp;eq_or_diff if defined &amp;eq_or_diff &amp;&amp; @_ &gt; 1;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ = map ref $_ ? Dumper( @_ ) : $_, @_;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto Test::&amp;ok;
&nbsp;&nbsp;&nbsp;&nbsp;}

&nbsp;&nbsp;&nbsp;&nbsp;plan tests =&gt; 1;

&nbsp;&nbsp;&nbsp;&nbsp;ok &quot;a&quot;, &quot;b&quot;;

=item *

PREREQ_PM =&gt; { .... &quot;Test::Differences&quot; =&gt; 0, ... }

This method will let CPAN and CPANPLUS users download it automatically.&nbsp;&nbsp;It
will discomfit those users who choose/have to download all packages manually.

=item *

t/lib/Test/Differences.pm, t/lib/Text/Diff.pm, ...

By placing Test::Differences and its prerequisites in the t/lib directory, you
avoid forcing your users to download the Test::Differences manually if they
aren&#39;t using CPAN or CPANPLUS.

If you put a C&lt;use lib &quot;t/lib&quot;;&gt; in the top of each test suite before the
C&lt;use Test::Differences;&gt;, C&lt;make test&gt; should work well.

You might want to check once in a while for new Test::Differences releases
if you do this.



=back

=cut</pre></td></tr>
<tr><td class="h">285</td><td colspan="6"></td></tr><tr><td class="h">286</td><td></td><td></td><td></td><td></td><td></td><td class="s">our $VERSION = &quot;0.61&quot;; # or &quot;0.001_001&quot; for a dev release</td></tr>
<tr><td class="h">287</td><td></td><td></td><td></td><td></td><td></td><td class="s">$VERSION = eval $VERSION;</td></tr>
<tr><td class="h">288</td><td colspan="6"></td></tr><tr><td class="h">289</td><td><div class="c3">6</div><div class="c3">6</div><div class="c3">6</div></td><td></td><td></td><td><div class="c3"><a href="local-lib-perl5-Test-Differences-pm--subroutine.html#L289">6</a></div></td><td><div>14</div><div>4</div><div>195</div></td><td class="s">use Exporter;</td></tr>
<tr><td class="h">290</td><td colspan="6"></td></tr><tr><td class="h">291</td><td></td><td></td><td></td><td></td><td></td><td class="s">@ISA&nbsp;&nbsp;&nbsp;&nbsp;= qw( Exporter );</td></tr>
<tr><td class="h">292</td><td></td><td></td><td></td><td></td><td></td><td class="s">@EXPORT = qw(</td></tr>
<tr><td class="h">293</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;eq_or_diff</td></tr>
<tr><td class="h">294</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;eq_or_diff_text</td></tr>
<tr><td class="h">295</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;eq_or_diff_data</td></tr>
<tr><td class="h">296</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;unified_diff</td></tr>
<tr><td class="h">297</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;context_diff</td></tr>
<tr><td class="h">298</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;oldstyle_diff</td></tr>
<tr><td class="h">299</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;table_diff</td></tr>
<tr><td class="h">300</td><td></td><td></td><td></td><td></td><td></td><td class="s">);</td></tr>
<tr><td class="h">301</td><td colspan="6"></td></tr><tr><td class="h">302</td><td><div class="c3">6</div><div class="c3">6</div><div class="c3">6</div></td><td></td><td></td><td><div class="c3"><a href="local-lib-perl5-Test-Differences-pm--subroutine.html#L302">6</a></div></td><td><div>12</div><div>5</div><div>61</div></td><td class="s">use strict;</td></tr>
<tr><td class="h">303</td><td colspan="6"></td></tr><tr><td class="h">304</td><td><div class="c3">6</div><div class="c3">6</div><div class="c3">6</div></td><td></td><td></td><td><div class="c3"><a href="local-lib-perl5-Test-Differences-pm--subroutine.html#L304">6</a></div></td><td><div>12</div><div>4</div><div>158</div></td><td class="s">use Carp;</td></tr>
<tr><td class="h">305</td><td><div class="c3">6</div><div class="c3">6</div><div class="c3">6</div></td><td></td><td></td><td><div class="c3"><a href="local-lib-perl5-Test-Differences-pm--subroutine.html#L305">6</a></div></td><td><div>844</div><div>6</div><div>1494</div></td><td class="s">use Text::Diff;</td></tr>
<tr><td class="h">306</td><td colspan="6"></td></tr><tr><td class="h">307</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _isnt_ARRAY_of_scalars {</td></tr>
<tr><td class="h">308</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L308">0</a></div></td><td></td><td><div class="c0"><a href="local-lib-perl5-Test-Differences-pm--subroutine.html#L308">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 1 if ref ne &quot;ARRAY&quot;;</td></tr>
<tr><td class="h">309</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return scalar grep ref, @$_;</td></tr>
<tr><td class="h">310</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">311</td><td colspan="6"></td></tr><tr><td class="h">312</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _isnt_HASH_of_scalars {</td></tr>
<tr><td class="h">313</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L313">0</a></div></td><td></td><td><div class="c0"><a href="local-lib-perl5-Test-Differences-pm--subroutine.html#L313">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 1 if ref ne &quot;HASH&quot;;</td></tr>
<tr><td class="h">314</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return scalar grep ref, values %$_;</td></tr>
<tr><td class="h">315</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">316</td><td colspan="6"></td></tr><tr><td class="h">317</td><td><div class="c3">6</div><div class="c3">6</div><div class="c3">6</div></td><td></td><td></td><td><div class="c3"><a href="local-lib-perl5-Test-Differences-pm--subroutine.html#L317">6</a></div></td><td><div>19</div><div>0</div><div>146</div></td><td class="s">use constant ARRAY_of_scalars&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &quot;ARRAY of scalars&quot;;</td></tr>
<tr><td class="h">318</td><td><div class="c3">6</div><div class="c3">6</div><div class="c3">6</div></td><td></td><td></td><td><div class="c3"><a href="local-lib-perl5-Test-Differences-pm--subroutine.html#L318">6</a></div></td><td><div>13</div><div>2</div><div>96</div></td><td class="s">use constant ARRAY_of_ARRAYs_of_scalars =&gt; &quot;ARRAY of ARRAYs of scalars&quot;;</td></tr>
<tr><td class="h">319</td><td><div class="c3">6</div><div class="c3">6</div><div class="c3">6</div></td><td></td><td></td><td><div class="c3"><a href="local-lib-perl5-Test-Differences-pm--subroutine.html#L319">6</a></div></td><td><div>9</div><div>5</div><div>80</div></td><td class="s">use constant ARRAY_of_HASHes_of_scalars =&gt; &quot;ARRAY of HASHes of scalars&quot;;</td></tr>
<tr><td class="h">320</td><td><div class="c3">6</div><div class="c3">6</div><div class="c3">6</div></td><td></td><td></td><td><div class="c3"><a href="local-lib-perl5-Test-Differences-pm--subroutine.html#L320">6</a></div></td><td><div>8</div><div>5</div><div>4145</div></td><td class="s">use constant HASH_of_scalars&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &quot;HASH of scalars&quot;;</td></tr>
<tr><td class="h">321</td><td colspan="6"></td></tr><tr><td class="h">322</td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">323</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $diff_style = &#39;Table&#39;;</td></tr>
<tr><td class="h">324</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %allowed_style = map { $_ =&gt; 1 } qw/Unified Context OldStyle Table/;</td></tr>
<tr><td class="h">325</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;sub _diff_style {</td></tr>
<tr><td class="h">326</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L326">0</a></div></td><td></td><td><div class="c0"><a href="local-lib-perl5-Test-Differences-pm--subroutine.html#L326">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $diff_style unless @_;</td></tr>
<tr><td class="h">327</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $requested_style = shift;</td></tr>
<tr><td class="h">328</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L328">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ( $allowed_style{$requested_style} ) {</td></tr>
<tr><td class="h">329</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Carp::croak(&quot;Uknown style ($requested_style) requested for diff&quot;);</td></tr>
<tr><td class="h">330</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">331</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$diff_style = $requested_style;</td></tr>
<tr><td class="h">332</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">333</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">334</td><td colspan="6"></td></tr><tr><td class="h">335</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="local-lib-perl5-Test-Differences-pm--subroutine.html#L335">0</a></div></td><td></td><td class="s">sub unified_diff&nbsp;&nbsp;{ _diff_style(&#39;Unified&#39;) }</td></tr>
<tr><td class="h">336</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="local-lib-perl5-Test-Differences-pm--subroutine.html#L336">0</a></div></td><td></td><td class="s">sub context_diff&nbsp;&nbsp;{ _diff_style(&#39;Context&#39;) }</td></tr>
<tr><td class="h">337</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="local-lib-perl5-Test-Differences-pm--subroutine.html#L337">0</a></div></td><td></td><td class="s">sub oldstyle_diff { _diff_style(&#39;OldStyle&#39;) }</td></tr>
<tr><td class="h">338</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="local-lib-perl5-Test-Differences-pm--subroutine.html#L338">0</a></div></td><td></td><td class="s">sub table_diff&nbsp;&nbsp;&nbsp;&nbsp;{ _diff_style(&#39;Table&#39;) }</td></tr>
<tr><td class="h">339</td><td colspan="6"></td></tr><tr><td class="h">340</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _grok_type {</td></tr>
<tr><td class="h">341</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L341">0</a></div></td><td></td><td><div class="c0"><a href="local-lib-perl5-Test-Differences-pm--subroutine.html#L341">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;local $_ = shift if @_;</td></tr>
<tr><td class="h">342</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L342">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &quot;SCALAR&quot; unless ref;</td></tr>
<tr><td class="h">343</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L343">0</a></div><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L343">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( ref eq &quot;ARRAY&quot; ) {</td></tr>
<tr><td class="h">344</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L344">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return undef unless @$_;</td></tr>
<tr><td class="h">345</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L345">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return ARRAY_of_scalars</td></tr>
<tr><td class="h">346</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless _isnt_ARRAY_of_scalars;</td></tr>
<tr><td class="h">347</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L347">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return ARRAY_of_ARRAYs_of_scalars</td></tr>
<tr><td class="h">348</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless grep _isnt_ARRAY_of_scalars, @$_;</td></tr>
<tr><td class="h">349</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L349">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return ARRAY_of_HASHes_of_scalars</td></tr>
<tr><td class="h">350</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless grep _isnt_HASH_of_scalars, @$_;</td></tr>
<tr><td class="h">351</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0;</td></tr>
<tr><td class="h">352</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">353</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;elsif ( ref eq &#39;HASH&#39; ) {</td></tr>
<tr><td class="h">354</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L354">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return HASH_of_scalars</td></tr>
<tr><td class="h">355</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless _isnt_HASH_of_scalars($_);</td></tr>
<tr><td class="h">356</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0;</td></tr>
<tr><td class="h">357</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">358</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">359</td><td colspan="6"></td></tr><tr><td class="h">360</td><td></td><td></td><td></td><td></td><td></td><td class="s">## Flatten any acceptable data structure in to an array of lines.</td></tr>
<tr><td class="h">361</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _flatten {</td></tr>
<tr><td class="h">362</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="local-lib-perl5-Test-Differences-pm--subroutine.html#L362">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $type = shift;</td></tr>
<tr><td class="h">363</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L363">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;local $_ = shift if @_;</td></tr>
<tr><td class="h">364</td><td colspan="6"></td></tr><tr><td class="h">365</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L365">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return [ split /^/m, _quote_str($_) ] unless ref;</td></tr>
<tr><td class="h">366</td><td colspan="6"></td></tr><tr><td class="h">367</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L367">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;croak &quot;Can&#39;t flatten $_&quot; unless $type;</td></tr>
<tr><td class="h">368</td><td colspan="6"></td></tr><tr><td class="h">369</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;## Copy the top level array so we don&#39;t trash the originals</td></tr>
<tr><td class="h">370</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( @recs, %hash_copy );</td></tr>
<tr><td class="h">371</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L371">0</a></div><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L371">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( ref $_ eq &#39;ARRAY&#39; ) {</td></tr>
<tr><td class="h">372</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@recs = @$_;</td></tr>
<tr><td class="h">373</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">374</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;elsif ( ref $_ eq &#39;HASH&#39; ) {</td></tr>
<tr><td class="h">375</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%hash_copy = %$_;</td></tr>
<tr><td class="h">376</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">377</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;else {</td></tr>
<tr><td class="h">378</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die &quot;unsupported ref type&quot;;</td></tr>
<tr><td class="h">379</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">380</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L380">0</a></div><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L380">0</a></div><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L380">0</a></div><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L380">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( $type eq ARRAY_of_scalars) {</td></tr>
<tr><td class="h">381</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@recs = map { _quote_str($_) } @recs;</td></tr>
<tr><td class="h">382</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">383</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;elsif ( $type eq ARRAY_of_ARRAYs_of_scalars ) {</td></tr>
<tr><td class="h">384</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;## Also copy the inner arrays if need be</td></tr>
<tr><td class="h">385</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_ = [@$_] for @recs;</td></tr>
<tr><td class="h">386</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">387</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;elsif ( $type eq ARRAY_of_HASHes_of_scalars ) {</td></tr>
<tr><td class="h">388</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %headings;</td></tr>
<tr><td class="h">389</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $rec (@recs) {</td></tr>
<tr><td class="h">390</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$headings{$_} = 1 for keys %$rec;</td></tr>
<tr><td class="h">391</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">392</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @headings = sort keys %headings;</td></tr>
<tr><td class="h">393</td><td colspan="6"></td></tr><tr><td class="h">394</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;## Convert all hashes in to arrays.</td></tr>
<tr><td class="h">395</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $rec (@recs) {</td></tr>
<tr><td class="h">396</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$rec = [ map $rec-&gt;{$_}, @headings ],;</td></tr>
<tr><td class="h">397</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">398</td><td colspan="6"></td></tr><tr><td class="h">399</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unshift @recs, \@headings;</td></tr>
<tr><td class="h">400</td><td colspan="6"></td></tr><tr><td class="h">401</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$type = ARRAY_of_ARRAYs_of_scalars;</td></tr>
<tr><td class="h">402</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">403</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;elsif ( $type eq HASH_of_scalars ) {</td></tr>
<tr><td class="h">404</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @headings = sort keys %hash_copy;</td></tr>
<tr><td class="h">405</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@recs = ( \@headings, [ map $hash_copy{$_}, @headings ] );</td></tr>
<tr><td class="h">406</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$type = ARRAY_of_ARRAYs_of_scalars;</td></tr>
<tr><td class="h">407</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">408</td><td colspan="6"></td></tr><tr><td class="h">409</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L409">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( $type eq ARRAY_of_ARRAYs_of_scalars ) {</td></tr>
<tr><td class="h">410</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;## Quote strings</td></tr>
<tr><td class="h">411</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $rec (@recs) {</td></tr>
<tr><td class="h">412</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (@$rec) {</td></tr>
<tr><td class="h">413</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_ = _quote_str($_);</td></tr>
<tr><td class="h">414</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">415</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$rec = join &quot;,&quot;, @$rec;</td></tr>
<tr><td class="h">416</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">417</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">418</td><td colspan="6"></td></tr><tr><td class="h">419</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return \@recs;</td></tr>
<tr><td class="h">420</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">421</td><td colspan="6"></td></tr><tr><td class="h">422</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _quote_str {</td></tr>
<tr><td class="h">423</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="local-lib-perl5-Test-Differences-pm--subroutine.html#L423">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $str = shift;</td></tr>
<tr><td class="h">424</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L424">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;undef&#39; unless defined $str;</td></tr>
<tr><td class="h">425</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L425">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $str if $str =~ /^[0-9]+$/;</td></tr>
<tr><td class="h">426</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$str =~ s{([\\\&#39;])}{\\$1}g;</td></tr>
<tr><td class="h">427</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &quot;&#39;$str&#39;&quot;;</td></tr>
<tr><td class="h">428</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">429</td><td colspan="6"></td></tr><tr><td class="h">430</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _identify_callers_test_package_of_choice {</td></tr>
<tr><td class="h">431</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;## This is called at each test in case Test::Differences was used before</td></tr>
<tr><td class="h">432</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;## the base testing modules.</td></tr>
<tr><td class="h">433</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;## First see if %INC tells us much of interest.</td></tr>
<tr><td class="h">434</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="local-lib-perl5-Test-Differences-pm--subroutine.html#L434">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $has_builder_pm = grep $_ eq &quot;Test/Builder.pm&quot;, keys %INC;</td></tr>
<tr><td class="h">435</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $has_test_pm&nbsp;&nbsp;&nbsp;&nbsp;= grep $_ eq &quot;Test.pm&quot;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keys %INC;</td></tr>
<tr><td class="h">436</td><td colspan="6"></td></tr><tr><td class="h">437</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L437">0</a></div></td><td><div class="c0"><a href="local-lib-perl5-Test-Differences-pm--condition.html#L437">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &quot;Test&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if $has_test_pm&nbsp;&nbsp;&amp;&amp; !$has_builder_pm;</td></tr>
<tr><td class="h">438</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L438">0</a></div></td><td><div class="c0"><a href="local-lib-perl5-Test-Differences-pm--condition.html#L438">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &quot;Test::Builder&quot; if !$has_test_pm &amp;&amp; $has_builder_pm;</td></tr>
<tr><td class="h">439</td><td colspan="6"></td></tr><tr><td class="h">440</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L440">0</a></div></td><td><div class="c0"><a href="local-lib-perl5-Test-Differences-pm--condition.html#L440">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( $has_test_pm &amp;&amp; $has_builder_pm ) {</td></tr>
<tr><td class="h">441</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;## TODO: Look in caller&#39;s namespace for hints.&nbsp;&nbsp;For now, assume Builder.</td></tr>
<tr><td class="h">442</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;## This should only ever be an issue if multiple test suites end</td></tr>
<tr><td class="h">443</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;## up in memory at once.</td></tr>
<tr><td class="h">444</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;Test::Builder&quot;;</td></tr>
<tr><td class="h">445</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">446</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">447</td><td colspan="6"></td></tr><tr><td class="h">448</td><td></td><td></td><td></td><td></td><td></td><td class="s">my $warned_of_unknown_test_lib;</td></tr>
<tr><td class="h">449</td><td colspan="6"></td></tr><tr><td class="h">450</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="local-lib-perl5-Test-Differences-pm--subroutine.html#L450">0</a></div></td><td></td><td class="s">sub eq_or_diff_text { $_[3] = { data_type =&gt; &quot;text&quot; }; goto &amp;eq_or_diff; }</td></tr>
<tr><td class="h">451</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="local-lib-perl5-Test-Differences-pm--subroutine.html#L451">0</a></div></td><td></td><td class="s">sub eq_or_diff_data { $_[3] = { data_type =&gt; &quot;data&quot; }; goto &amp;eq_or_diff; }</td></tr>
<tr><td class="h">452</td><td colspan="6"></td></tr><tr><td class="h">453</td><td></td><td></td><td></td><td></td><td></td><td class="s">## This string is a cheat: it&#39;s used to see if the two arrays of values</td></tr>
<tr><td class="h">454</td><td></td><td></td><td></td><td></td><td></td><td class="s">## are identical.&nbsp;&nbsp;The stringified values are joined using this joint</td></tr>
<tr><td class="h">455</td><td></td><td></td><td></td><td></td><td></td><td class="s">## and compared using eq.&nbsp;&nbsp;This is a deep equality comparison for</td></tr>
<tr><td class="h">456</td><td></td><td></td><td></td><td></td><td></td><td class="s">## references and a shallow one for scalars.</td></tr>
<tr><td class="h">457</td><td></td><td></td><td></td><td></td><td></td><td class="s">my $joint = chr(0) . &quot;A&quot; . chr(1);</td></tr>
<tr><td class="h">458</td><td colspan="6"></td></tr><tr><td class="h">459</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub eq_or_diff {</td></tr>
<tr><td class="h">460</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="local-lib-perl5-Test-Differences-pm--subroutine.html#L460">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( @vals, $name, $options );</td></tr>
<tr><td class="h">461</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L461">0</a></div></td><td><div class="c0"><a href="local-lib-perl5-Test-Differences-pm--condition.html#L461">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$options = pop if @_ &gt; 2 &amp;&amp; ref $_[-1];</td></tr>
<tr><td class="h">462</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;( $vals[0], $vals[1], $name ) = @_;</td></tr>
<tr><td class="h">463</td><td colspan="6"></td></tr><tr><td class="h">464</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $data_type;</td></tr>
<tr><td class="h">465</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L465">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$data_type = $options-&gt;{data_type} if $options;</td></tr>
<tr><td class="h">466</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L466">0</a></div></td><td><div class="c0"><a href="local-lib-perl5-Test-Differences-pm--condition.html#L466">0</a></div><div class="c0"><a href="local-lib-perl5-Test-Differences-pm--condition.html#L466">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$data_type ||= &quot;text&quot; unless ref $vals[0] || ref $vals[1];</td></tr>
<tr><td class="h">467</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="local-lib-perl5-Test-Differences-pm--condition.html#L467">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$data_type ||= &quot;data&quot;;</td></tr>
<tr><td class="h">468</td><td colspan="6"></td></tr><tr><td class="h">469</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @widths;</td></tr>
<tr><td class="h">470</td><td colspan="6"></td></tr><tr><td class="h">471</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @types = map _grok_type, @vals;</td></tr>
<tr><td class="h">472</td><td colspan="6"></td></tr><tr><td class="h">473</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="local-lib-perl5-Test-Differences-pm--condition.html#L473">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $dump_it = !$types[0] || !$types[1];</td></tr>
<tr><td class="h">474</td><td colspan="6"></td></tr><tr><td class="h">475</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $got, $expected );</td></tr>
<tr><td class="h">476</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L476">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($dump_it) {</td></tr>
<tr><td class="h">477</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;require Data::Dumper;</td></tr>
<tr><td class="h">478</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local $Data::Dumper::Indent&nbsp;&nbsp;&nbsp;&nbsp;= 1;</td></tr>
<tr><td class="h">479</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local $Data::Dumper::Purity&nbsp;&nbsp;&nbsp;&nbsp;= 0;</td></tr>
<tr><td class="h">480</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local $Data::Dumper::Terse&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 1;</td></tr>
<tr><td class="h">481</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local $Data::Dumper::Deepcopy&nbsp;&nbsp;= 1;</td></tr>
<tr><td class="h">482</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local $Data::Dumper::Quotekeys = 0;</td></tr>
<tr><td class="h">483</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L483">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local $Data::Dumper::Sortkeys =</td></tr>
<tr><td class="h">484</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists $options-&gt;{Sortkeys} ? $options-&gt;{Sortkeys} : 1;</td></tr>
<tr><td class="h">485</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( $got, $expected ) = map</td></tr>
<tr><td class="h">486</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ split /^/, Data::Dumper::Dumper($_) ],</td></tr>
<tr><td class="h">487</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@vals;</td></tr>
<tr><td class="h">488</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">489</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;else {</td></tr>
<tr><td class="h">490</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( $got, $expected ) = (</td></tr>
<tr><td class="h">491</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_flatten( $types[0], $vals[0] ),</td></tr>
<tr><td class="h">492</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_flatten( $types[1], $vals[1] )</td></tr>
<tr><td class="h">493</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">494</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">495</td><td colspan="6"></td></tr><tr><td class="h">496</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $caller = caller;</td></tr>
<tr><td class="h">497</td><td colspan="6"></td></tr><tr><td class="h">498</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $passed</td></tr>
<tr><td class="h">499</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= join( $joint, @$got ) eq join( $joint, @$expected );</td></tr>
<tr><td class="h">500</td><td colspan="6"></td></tr><tr><td class="h">501</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $diff;</td></tr>
<tr><td class="h">502</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L502">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless ($passed) {</td></tr>
<tr><td class="h">503</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $context;</td></tr>
<tr><td class="h">504</td><td colspan="6"></td></tr><tr><td class="h">505</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L505">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$context = $options-&gt;{context}</td></tr>
<tr><td class="h">506</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if exists $options-&gt;{context};</td></tr>
<tr><td class="h">507</td><td colspan="6"></td></tr><tr><td class="h">508</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L508">0</a></div><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L508">0</a></div><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L508">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$context = $dump_it ? 2**31 : grep( @$_ &gt; 25, $got, $expected ) ? 3 : 25</td></tr>
<tr><td class="h">509</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless defined $context;</td></tr>
<tr><td class="h">510</td><td colspan="6"></td></tr><tr><td class="h">511</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L511">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;confess &quot;context must be an integer: &#39;$context&#39;\n&quot;</td></tr>
<tr><td class="h">512</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless $context =~ /\A\d+\z/;</td></tr>
<tr><td class="h">513</td><td colspan="6"></td></tr><tr><td class="h">514</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L514">0</a></div><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L514">0</a></div><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L514">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$diff = diff $got, $expected,</td></tr>
<tr><td class="h">515</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ CONTEXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $context,</td></tr>
<tr><td class="h">516</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STYLE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; _diff_style(),</td></tr>
<tr><td class="h">517</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FILENAME_A&nbsp;&nbsp;=&gt; &quot;Got&quot;,</td></tr>
<tr><td class="h">518</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FILENAME_B&nbsp;&nbsp;=&gt; &quot;Expected&quot;,</td></tr>
<tr><td class="h">519</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OFFSET_A&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $data_type eq &quot;text&quot; ? 1 : 0,</td></tr>
<tr><td class="h">520</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OFFSET_B&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $data_type eq &quot;text&quot; ? 1 : 0,</td></tr>
<tr><td class="h">521</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INDEX_LABEL =&gt; $data_type eq &quot;text&quot; ? &quot;Ln&quot; : &quot;Elt&quot;,</td></tr>
<tr><td class="h">522</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">523</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chomp $diff;</td></tr>
<tr><td class="h">524</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$diff .= &quot;\n&quot;;</td></tr>
<tr><td class="h">525</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">526</td><td colspan="6"></td></tr><tr><td class="h">527</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $which = _identify_callers_test_package_of_choice;</td></tr>
<tr><td class="h">528</td><td colspan="6"></td></tr><tr><td class="h">529</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L529">0</a></div><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L529">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( $which eq &quot;Test&quot; ) {</td></tr>
<tr><td class="h">530</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_</td></tr>
<tr><td class="h">531</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L531">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= $passed</td></tr>
<tr><td class="h">532</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;? ( &quot;&quot;, &quot;&quot;, $name )</td></tr>
<tr><td class="h">533</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: ( &quot;\n$diff&quot;, &quot;No differences&quot;, $name );</td></tr>
<tr><td class="h">534</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto &amp;Test::ok;</td></tr>
<tr><td class="h">535</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">536</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;elsif ( $which eq &quot;Test::Builder&quot; ) {</td></tr>
<tr><td class="h">537</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $test = Test::Builder-&gt;new;</td></tr>
<tr><td class="h">538</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;## TODO: Call exported_to here?&nbsp;&nbsp;May not need to because the caller</td></tr>
<tr><td class="h">539</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;## should have imported something based on Test::Builder already.</td></tr>
<tr><td class="h">540</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$test-&gt;ok( $passed, $name );</td></tr>
<tr><td class="h">541</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L541">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$test-&gt;diag($diff) unless $passed;</td></tr>
<tr><td class="h">542</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">543</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;else {</td></tr>
<tr><td class="h">544</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L544">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ($warned_of_unknown_test_lib) {</td></tr>
<tr><td class="h">545</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Carp::cluck</td></tr>
<tr><td class="h">546</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;Can&#39;t identify test lib in use, doesn&#39;t seem to be Test.pm or Test::Builder based\n&quot;;</td></tr>
<tr><td class="h">547</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$warned_of_unknown_test_lib = 1;</td></tr>
<tr><td class="h">548</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">549</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;## Play dumb and hope nobody notices the fool drooling in the corner</td></tr>
<tr><td class="h">550</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="local-lib-perl5-Test-Differences-pm--branch.html#L550">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($passed) {</td></tr>
<tr><td class="h">551</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print &quot;ok\n&quot;;</td></tr>
<tr><td class="h">552</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">553</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else {</td></tr>
<tr><td class="h">554</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$diff =~ s/^/# /gm;</td></tr>
<tr><td class="h">555</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print &quot;not ok\n&quot;, $diff;</td></tr>
<tr><td class="h">556</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">557</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">558</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">559</td><td colspan="6"></td></tr><tr><td class="h">560 - 650</td><td colspan="5"></td><td class="s"><pre>=head1 LIMITATIONS

=head2 C&lt;Test&gt; or C&lt;Test::More&gt;

This module &quot;mixes in&quot; with Test.pm or any of the test libraries based on
Test::Builder (Test::Simple, Test::More, etc).&nbsp;&nbsp;It does this by peeking to see
whether Test.pm or Test/Builder.pm is in %INC, so if you are not using one of
those, it will print a warning and play dumb by not emitting test numbers (or
incrementing them).&nbsp;&nbsp;If you are using one of these, it should interoperate
nicely.

=head2 Exporting

Exports all 3 functions by default (and by design).&nbsp;&nbsp;Use

&nbsp;&nbsp;&nbsp;&nbsp;use Test::Differences ();

to suppress this behavior if you don&#39;t like the namespace pollution.

This module will not override functions like ok(), is(), is_deeply(), etc.&nbsp;&nbsp;If
it did, then you could C&lt;eval &quot;use Test::Differences qw( is_deeply );&quot;&gt; to get
automatic upgrading to diffing behaviors without the C&lt;sub my_ok&gt; shown above.
Test::Differences intentionally does not provide this behavior because this
would mean that Test::Differences would need to emulate every popular test
module out there, which would require far more coding and maintenance that I&#39;m
willing to do.&nbsp;&nbsp;Use the eval and my_ok deployment shown above if you want some
level of automation.

=head2 Unicode

Perls before 5.6.0 don&#39;t support characters &gt; 255 at all, and 5.6.0
seems broken.&nbsp;&nbsp;This means that you might get odd results using perl5.6.0
with unicode strings.

=head2 C&lt;Data::Dumper&gt; and older Perls.

Relies on Data::Dumper (for now), which, prior to perl5.8, will not always
report hashes in the same order.&nbsp;&nbsp;C&lt; $Data::Dumper::SortKeys &gt; I&lt;is&gt; set to 1,
so on more recent versions of Data::Dumper, this should not occur.&nbsp;&nbsp;Check CPAN
to see if it&#39;s been peeled out of the main perl distribution and backported.
Reported by Ilya Martynov &lt;ilya@martynov.org&gt;, although the SortKeys &quot;future
perfect&quot; workaround has been set in anticipation of a new Data::Dumper for a
while.&nbsp;&nbsp;Note that the two hashes should report the same here:

&nbsp;&nbsp;&nbsp;&nbsp;not ok 5
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Failed test (t/ctrl/05-home.t at line 51)
&nbsp;&nbsp;&nbsp;&nbsp;# +----+------------------------+----+------------------------+
&nbsp;&nbsp;&nbsp;&nbsp;# | Elt|Got&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| Elt|Expected&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|
&nbsp;&nbsp;&nbsp;&nbsp;# +----+------------------------+----+------------------------+
&nbsp;&nbsp;&nbsp;&nbsp;# |&nbsp;&nbsp;&nbsp;0|{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;0|{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|
&nbsp;&nbsp;&nbsp;&nbsp;# |&nbsp;&nbsp;&nbsp;1|&nbsp;&nbsp;&#39;password&#39; =&gt; &#39;&#39;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;1|&nbsp;&nbsp;&#39;password&#39; =&gt; &#39;&#39;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|
&nbsp;&nbsp;&nbsp;&nbsp;# *&nbsp;&nbsp;&nbsp;2|&nbsp;&nbsp;&#39;method&#39; =&gt; &#39;login&#39;,&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|
&nbsp;&nbsp;&nbsp;&nbsp;# |&nbsp;&nbsp;&nbsp;3|&nbsp;&nbsp;&#39;ctrl&#39; =&gt; &#39;home&#39;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;2|&nbsp;&nbsp;&#39;ctrl&#39; =&gt; &#39;home&#39;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|
&nbsp;&nbsp;&nbsp;&nbsp;# |&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;3|&nbsp;&nbsp;&#39;method&#39; =&gt; &#39;login&#39;,&nbsp;&nbsp;*
&nbsp;&nbsp;&nbsp;&nbsp;# |&nbsp;&nbsp;&nbsp;4|&nbsp;&nbsp;&#39;email&#39; =&gt; &#39;test&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;4|&nbsp;&nbsp;&#39;email&#39; =&gt; &#39;test&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|
&nbsp;&nbsp;&nbsp;&nbsp;# |&nbsp;&nbsp;&nbsp;5|}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;5|}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|
&nbsp;&nbsp;&nbsp;&nbsp;# +----+------------------------+----+------------------------+

Data::Dumper also overlooks the difference between

&nbsp;&nbsp;&nbsp;&nbsp;$a[0] = \$a[1];
&nbsp;&nbsp;&nbsp;&nbsp;$a[1] = \$a[0];&nbsp;&nbsp;&nbsp;# $a[0] = \$a[1]

and

&nbsp;&nbsp;&nbsp;&nbsp;$x = \$y;
&nbsp;&nbsp;&nbsp;&nbsp;$y = \$x;
&nbsp;&nbsp;&nbsp;&nbsp;@a = ( $x, $y );&nbsp;&nbsp;# $a[0] = \$y, not \$a[1]

The former involves two scalars, the latter 4: $x, $y, and @a[0,1].
This was carefully explained to me in words of two syllables or less by
Yves Orton &lt;demerphq@hotmail.com&gt;.&nbsp;&nbsp;The plan to address this is to allow
you to select Data::Denter or some other module of your choice as an
option.

=head1 AUTHOR

&nbsp;&nbsp;&nbsp;&nbsp;Barrie Slaymaker &lt;barries@slaysys.com&gt;

=head1 MAINTAINER

&nbsp;&nbsp;&nbsp;&nbsp;Curtis &quot;Ovid&quot; Poe &lt;ovid@cpan.org&gt;

=head1 LICENSE

Copyright 2001-2008 Barrie Slaymaker, All Rights Reserved.

You may use this software under the terms of the GNU public license, any
version, or the Artistic license.

=cut</pre></td></tr>
<tr><td class="h">651</td><td colspan="6"></td></tr><tr><td class="h">652</td><td></td><td></td><td></td><td></td><td></td><td class="s">1;</td></tr>
</table>
</body>
</html>
